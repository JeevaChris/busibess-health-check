<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>BizVitals 360 - Step-by-Step Assessment</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f2f7f5;
      margin: 0;
      padding: 20px;
    }
    .container {
      max-width: 900px;
      margin: 0 auto;
      background: #fff;
      padding: 30px;
      border-radius: 10px;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
    }
    h2 {
      color: #2b8a3e;
      text-align: center;
      margin-bottom: 20px;
    }
    .category-status {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
      justify-content: center;
      margin-bottom: 20px;
    }
    .category-badge {
      padding: 8px 12px;
      background: #e0f1e7;
      border-radius: 6px;
      color: #2b8a3e;
      font-weight: bold;
      border: 2px solid transparent;
      cursor: pointer;
    }
    .category-badge.active {
      background: #2b8a3e;
      color: #fff;
      border-color: #2b8a3e;
    }
    .question-box {
      margin: 20px 0;
    }
    .question-text {
      font-size: 1.1rem;
      margin-bottom: 10px;
    }
    .options label {
      display: block;
      margin-bottom: 8px;
    }
    .btn-group {
      display: flex;
      justify-content: space-between;
      margin-top: 20px;
    }
    .btn {
      background: #2b8a3e;
      color: white;
      padding: 10px 20px;
      border: none;
      border-radius: 5px;
      cursor: pointer;
    }
    .btn:hover {
      background: #237032;
    }
  </style>
</head>
<body>
  <div class="container">
    <h2>BizVitals 360 - Business Health Assessment</h2>
    <div class="category-status" id="categoryStatus"></div>
    <div id="questionSection"></div>
    <div class="btn-group">
      <button class="btn" onclick="saveProgress()">Save</button>
      <button class="btn" onclick="nextQuestion()" id="nextBtn" disabled>Next</button>
      <button class="btn" onclick="submitAssessment()" id="submitBtn" style="display:none;">Submit</button>
    </div>
  </div>

  <script>
    const categories = [/* same category objects */];
    const scores = { "Yes": 1, "In Process": 0.5, "No": 0, "Not Applicable": 0 };
    const userResponses = [];
    let currentCategory = 0;
    let currentQuestion = 0;
    const section = document.getElementById("questionSection");
    const nextBtn = document.getElementById("nextBtn");
    const submitBtn = document.getElementById("submitBtn");
    const statusDiv = document.getElementById("categoryStatus");

    function renderCategoryBadges() {
      statusDiv.innerHTML = "";
      categories.forEach((cat, i) => {
        const div = document.createElement("div");
        div.className = "category-badge" + (i === currentCategory ? " active" : "");
        div.textContent = cat.title;
        div.onclick = () => {
          currentCategory = i;
          currentQuestion = 0;
          renderQuestion();
        };
        statusDiv.appendChild(div);
      });
    }

    function renderQuestion() {
      renderCategoryBadges();
      nextBtn.disabled = true;
      submitBtn.style.display = "none";
      const category = categories[currentCategory];
      const question = category.questions[currentQuestion];
      section.innerHTML = `
        <h3>${category.title}</h3>
        <div class="question-box">
          <div class="question-text">${question.text}</div>
          <div class="options">
            ${Object.keys(scores).map(option => `
              <label>
                <input type="radio" name="response" value="${option}" onchange="enableNext()" /> ${option}
              </label>
            `).join('')}
          </div>
        </div>
      `;
    }

    function enableNext() {
      nextBtn.disabled = false;
    }

    function nextQuestion() {
      const selected = document.querySelector('input[name="response"]:checked');
      const value = selected ? selected.value : "Not Applicable";
      const question = categories[currentCategory].questions[currentQuestion];
      userResponses.push({ category: categories[currentCategory].title, score: scores[value] * question.weight, weight: question.weight });

      currentQuestion++;
      if (currentQuestion >= categories[currentCategory].questions.length) {
        currentQuestion = 0;
        currentCategory++;
      }

      if (currentCategory >= categories.length) {
        nextBtn.style.display = "none";
        submitBtn.style.display = "inline-block";
        section.innerHTML = "<h3>All questions completed. Click Submit to see results.</h3>";
        renderCategoryBadges();
      } else {
        renderQuestion();
      }
    }

    function saveProgress() {
      localStorage.setItem("savedResponses", JSON.stringify(userResponses));
      alert("Progress saved successfully.");
    }

    function submitAssessment() {
      const categoryScores = {};
      const categoryTotals = {};
      userResponses.forEach(({ category, score, weight }) => {
        categoryScores[category] = (categoryScores[category] || 0) + score;
        categoryTotals[category] = (categoryTotals[category] || 0) + weight;
      });
      localStorage.setItem("categoryScores", JSON.stringify(categoryScores));
      localStorage.setItem("categoryTotals", JSON.stringify(categoryTotals));
      window.location.href = "result.html";
    }

    renderQuestion();
  </script>
</body>
</html>
