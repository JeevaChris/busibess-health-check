<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>BizVitals 360 - Assessment</title>
  <link rel="stylesheet" href="style.css" />
  <style>
    .subcategory-title {
      font-size: 1.1rem;
      color: #1a5d3f;
      margin-top: 10px;
      margin-bottom: 10px;
      background: #e6f4ea;
      padding: 8px;
      border-left: 4px solid #2b8a3e;
    }
    .question-block {
      display: none;
    }
    .question-block.active {
      display: block;
    }
    .category-buttons {
      text-align: right;
      margin-top: 20px;
    }
  </style>
</head>
<body>
  <header>Business Health Assessment</header>
  <div class="container">
    <form id="assessment-section">
      <div id="questions-container"></div>
    </form>
  </div>

  <script>
    const groupedQuestions = {
      "Revenue & Profitability": {
        "Sales & Growth": [
          "Are you getting more sales or customers than you did last year?",
          "Are you less dependent on a single customer or product to keep your business running?",
          "Have your profit margins improved or stayed stable in the past 12 months?",
          "Could your business stay profitable if revenue dropped by 10%?",
          "Do you track revenue trends by product, service, or region?",
          "Is your pricing strategy aligned with customer value and market position?",
          "Are you regularly reviewing financial reports to assess profit trends?"
        ]
      },
      "Cash Flow & Liquidity": {
        "Cash Stability": [
          "Can you handle your regular business expenses without borrowing or delays?",
          "Do you have some money saved to manage slow months or emergencies?",
          "Do you know how much money is coming in and going out every month?",
          "Do you consistently generate more cash than you spend each month?",
          "Can you access funds quickly in case of a cash crunch?",
          "Do you forecast your cash flow at least monthly?",
          "Have you separated personal and business finances completely?",
          "Do you avoid frequent reliance on credit for regular expenses?"
        ]
      },
      "Cost & Expense Management": {
        "Spending Efficiency": [
          "Are most of your costs helping your business grow or run better?",
          "Could you reduce spending quickly if needed, without hurting your business?",
          "Do you track your spending against a monthly or quarterly budget?",
          "Do you routinely review and optimize supplier and vendor contracts?",
          "Have you identified your top 3 cost drivers in the business?",
          "Do you run a break-even analysis when planning large expenses?",
          "Do you review expense reports or accounts monthly?"
        ]
      },
      "Working Capital & Efficiency": {
        "Receivables & Payables": [
          "Do your customers usually pay you on time?",
          "Can you pay your suppliers and bills on time without waiting for new income?",
          "Could your business keep running for a few months if sales dropped suddenly?",
          "Are most of your invoices paid within 30 days?",
          "Do you keep enough inventory to meet demand without overstocking?",
          "Do you review how quickly you convert inventory into sales?",
          "Are your payable and receivable cycles optimized to avoid cash gaps?",
          "Do you monitor short-term assets and liabilities monthly?"
        ]
      }
    };

    const scoringMap = { "Yes": 10, "In Process": 5, "No": 0, "N/A": 0 };
    const categoryKeys = Object.keys(groupedQuestions);
    let currentCategoryIndex = 0;
    let allQuestions = [];
    let currentQuestionIndex = 0;

    function generateQuestions() {
      const category = categoryKeys[currentCategoryIndex];
      const subcats = groupedQuestions[category];
      const container = document.getElementById("questions-container");
      container.innerHTML = "";
      allQuestions = [];
      currentQuestionIndex = 0;

      const header = document.createElement("h2");
      header.textContent = category;
      container.appendChild(header);

      for (const subcat in subcats) {
        const subHeader = document.createElement("div");
        subHeader.className = "subcategory-title";
        subHeader.textContent = subcat;
        container.appendChild(subHeader);

        subcats[subcat].forEach((q, i) => {
          const div = document.createElement("div");
          div.className = "question-block";
          div.innerHTML = `
            <p><strong>Q${allQuestions.length + 1}:</strong> ${q}</p>
            <label><input type="radio" name="q${currentCategoryIndex}_${allQuestions.length}" value="Yes"> ‚úÖ Yes</label>
            <label><input type="radio" name="q${currentCategoryIndex}_${allQuestions.length}" value="In Process"> üîÑ In Process</label>
            <label><input type="radio" name="q${currentCategoryIndex}_${allQuestions.length}" value="No"> ‚ùå No</label>
            <label><input type="radio" name="q${currentCategoryIndex}_${allQuestions.length}" value="N/A"> üîò N/A</label>
            <button type="button" onclick="nextQuestion(${allQuestions.length})">Next</button>
          `;
          container.appendChild(div);
          allQuestions.push(div);
        });
      }

      const saveBtn = document.createElement("div");
      saveBtn.className = "category-buttons";
      saveBtn.innerHTML = `
        <button type="button" onclick="saveAssessment()">üíæ Save This Category</button>
      `;
      container.appendChild(saveBtn);

      allQuestions[0].classList.add("active");
    }

    function nextQuestion(index) {
      const currentBlock = allQuestions[index];
      const selected = currentBlock.querySelector('input[type="radio"]:checked');
      if (!selected) return alert("Please select an option.");
      currentBlock.classList.remove("active");

      const qText = currentBlock.querySelector('p')?.textContent || "Untitled Question";
      const category = categoryKeys[currentCategoryIndex];
      const qKey = `q${currentCategoryIndex}_${index}`;
      const savedAnswers = JSON.parse(localStorage.getItem("bizvitals_answers") || "{}");
      savedAnswers[qKey] = {
        value: selected.value,
        text: qText,
        category: category
      };
      localStorage.setItem("bizvitals_answers", JSON.stringify(savedAnswers));

      if (index + 1 < allQuestions.length) {
        allQuestions[index + 1].classList.add("active");
        allQuestions[index + 1].scrollIntoView({ behavior: 'smooth' });
      } else {
        currentCategoryIndex++;
        if (currentCategoryIndex < categoryKeys.length) {
          generateQuestions();
        } else {
          window.location.href = "result.html";
        }
      }
    }

    function saveAssessment() {
      alert("‚úÖ Your responses for this category have been saved.");
    }

    window.onload = generateQuestions;
  </script>
</body>
</html>
